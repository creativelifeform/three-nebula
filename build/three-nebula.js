!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Nebula=e():t.Nebula=e()}(this,(function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=48)}([function(t,e,i){"use strict";i.d(e,"a",(function(){return r})),i.d(e,"b",(function(){return n})),i.d(e,"e",(function(){return s})),i.d(e,"d",(function(){return o})),i.d(e,"c",(function(){return a}));const r="BaseRenderer",n="CustomRenderer",s="SpriteRenderer",o="MeshRenderer",a="GPURenderer"},function(t,e){t.exports=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}},function(t,e,i){"use strict";i.d(e,"g",(function(){return r})),i.d(e,"d",(function(){return n})),i.d(e,"f",(function(){return s})),i.d(e,"e",(function(){return o})),i.d(e,"a",(function(){return a})),i.d(e,"c",(function(){return h})),i.d(e,"b",(function(){return c})),i.d(e,"h",(function(){return u}));const r="SYSTEM_UPDATE",n="PARTICLE_CREATED",s="PARTICLE_UPDATE",o="PARTICLE_DEAD",a="EMITTER_ADDED",h="EMITTER_REMOVED",c="EMITTER_DEAD",u="SYSTEM_UPDATE_AFTER"},function(t,e,i){var r=i(5),n=i(6);t.exports=function(t){return"number"==typeof t||n(t)&&"[object Number]"==r(t)}},function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return s}));var r=i(2),n=i(0);class s{constructor(t=n.a){this.type=t}init(t){var e=this;this.system=t,this.system.eventDispatcher.addEventListener(r.g,(function(t){e.onSystemUpdate.call(e,t)})),this.system.eventDispatcher.addEventListener(r.d,(function(t){e.onParticleCreated.call(e,t)})),this.system.eventDispatcher.addEventListener(r.f,(function(t){e.onParticleUpdate.call(e,t)})),this.system.eventDispatcher.addEventListener(r.e,(function(t){e.onParticleDead.call(e,t)})),this.logRendererType()}remove(){this.system=null}onParticleCreated(t){}onParticleUpdate(t){}onParticleDead(t){}onSystemUpdate(t){}logRendererType(){t&&t.env}}}).call(this,i(47))},function(t,e,i){var r=i(9),n=i(30),s=i(31),o=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":o&&o in Object(t)?n(t):s(t)}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e,i){var r=i(8),n=i(20),s=i(12);t.exports=function(t){return(s(t)?r:n)(t)}},function(t,e,i){var r=i(19);t.exports=function(t){var e=t.length;return e?t[r(0,e-1)]:void 0}},function(t,e,i){var r=i(10).Symbol;t.exports=r},function(t,e,i){var r=i(11),n="object"==typeof self&&self&&self.Object===Object&&self,s=r||n||Function("return this")();t.exports=s},function(t,e,i){(function(e){var i="object"==typeof e&&e&&e.Object===Object&&e;t.exports=i}).call(this,i(29))},function(t,e){var i=Array.isArray;t.exports=i},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){t.exports=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}},function(t,e,i){var r,n,s=i(17),o=i(18),a=0,h=0;t.exports=function(t,e,i){var c=e&&i||0,u=e||[],l=(t=t||{}).node||r,d=void 0!==t.clockseq?t.clockseq:n;if(null==l||null==d){var f=s();null==l&&(l=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==d&&(d=n=16383&(f[6]<<8|f[7]))}var p=void 0!==t.msecs?t.msecs:(new Date).getTime(),y=void 0!==t.nsecs?t.nsecs:h+1,m=p-a+(y-h)/1e4;if(m<0&&void 0===t.clockseq&&(d=d+1&16383),(m<0||p>a)&&void 0===t.nsecs&&(y=0),y>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=p,h=y,n=d;var g=(1e4*(268435455&(p+=122192928e5))+y)%4294967296;u[c++]=g>>>24&255,u[c++]=g>>>16&255,u[c++]=g>>>8&255,u[c++]=255&g;var x=p/4294967296*1e4&268435455;u[c++]=x>>>8&255,u[c++]=255&x,u[c++]=x>>>24&15|16,u[c++]=x>>>16&255,u[c++]=d>>>8|128,u[c++]=255&d;for(var v=0;v<6;++v)u[c+v]=l[v];return e||o(u)}},function(t,e,i){var r=i(46);t.exports=function(t,e){if(null==t)return{};var i,n,s=r(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)i=o[n],e.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(t,i)&&(s[i]=t[i])}return s}},function(t,e){var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(i){var r=new Uint8Array(16);t.exports=function(){return i(r),r}}else{var n=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),n[e]=t>>>((3&e)<<3)&255;return n}}},function(t,e){for(var i=[],r=0;r<256;++r)i[r]=(r+256).toString(16).substr(1);t.exports=function(t,e){var r=e||0,n=i;return[n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]]].join("")}},function(t,e){var i=Math.floor,r=Math.random;t.exports=function(t,e){return t+i(r()*(e-t+1))}},function(t,e,i){var r=i(8),n=i(21);t.exports=function(t){return r(n(t))}},function(t,e,i){var r=i(22),n=i(24);t.exports=function(t){return null==t?[]:r(t,n(t))}},function(t,e,i){var r=i(23);t.exports=function(t,e){return r(e,(function(e){return t[e]}))}},function(t,e){t.exports=function(t,e){for(var i=-1,r=null==t?0:t.length,n=Array(r);++i<r;)n[i]=e(t[i],i,t);return n}},function(t,e,i){var r=i(25),n=i(39),s=i(43);t.exports=function(t){return s(t)?r(t):n(t)}},function(t,e,i){var r=i(26),n=i(27),s=i(12),o=i(32),a=i(34),h=i(35),c=Object.prototype.hasOwnProperty;t.exports=function(t,e){var i=s(t),u=!i&&n(t),l=!i&&!u&&o(t),d=!i&&!u&&!l&&h(t),f=i||u||l||d,p=f?r(t.length,String):[],y=p.length;for(var m in t)!e&&!c.call(t,m)||f&&("length"==m||l&&("offset"==m||"parent"==m)||d&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||a(m,y))||p.push(m);return p}},function(t,e){t.exports=function(t,e){for(var i=-1,r=Array(t);++i<t;)r[i]=e(i);return r}},function(t,e,i){var r=i(28),n=i(6),s=Object.prototype,o=s.hasOwnProperty,a=s.propertyIsEnumerable,h=r(function(){return arguments}())?r:function(t){return n(t)&&o.call(t,"callee")&&!a.call(t,"callee")};t.exports=h},function(t,e,i){var r=i(5),n=i(6);t.exports=function(t){return n(t)&&"[object Arguments]"==r(t)}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){var r=i(9),n=Object.prototype,s=n.hasOwnProperty,o=n.toString,a=r?r.toStringTag:void 0;t.exports=function(t){var e=s.call(t,a),i=t[a];try{t[a]=void 0;var r=!0}catch(t){}var n=o.call(t);return r&&(e?t[a]=i:delete t[a]),n}},function(t,e){var i=Object.prototype.toString;t.exports=function(t){return i.call(t)}},function(t,e,i){(function(t){var r=i(10),n=i(33),s=e&&!e.nodeType&&e,o=s&&"object"==typeof t&&t&&!t.nodeType&&t,a=o&&o.exports===s?r.Buffer:void 0,h=(a?a.isBuffer:void 0)||n;t.exports=h}).call(this,i(13)(t))},function(t,e){t.exports=function(){return!1}},function(t,e){var i=/^(?:0|[1-9]\d*)$/;t.exports=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&i.test(t))&&t>-1&&t%1==0&&t<e}},function(t,e,i){var r=i(36),n=i(37),s=i(38),o=s&&s.isTypedArray,a=o?n(o):r;t.exports=a},function(t,e,i){var r=i(5),n=i(14),s=i(6),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,t.exports=function(t){return s(t)&&n(t.length)&&!!o[r(t)]}},function(t,e){t.exports=function(t){return function(e){return t(e)}}},function(t,e,i){(function(t){var r=i(11),n=e&&!e.nodeType&&e,s=n&&"object"==typeof t&&t&&!t.nodeType&&t,o=s&&s.exports===n&&r.process,a=function(){try{var t=s&&s.require&&s.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=a}).call(this,i(13)(t))},function(t,e,i){var r=i(40),n=i(41),s=Object.prototype.hasOwnProperty;t.exports=function(t){if(!r(t))return n(t);var e=[];for(var i in Object(t))s.call(t,i)&&"constructor"!=i&&e.push(i);return e}},function(t,e){var i=Object.prototype;t.exports=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||i)}},function(t,e,i){var r=i(42)(Object.keys,Object);t.exports=r},function(t,e){t.exports=function(t,e){return function(i){return t(e(i))}}},function(t,e,i){var r=i(44),n=i(14);t.exports=function(t){return null!=t&&n(t.length)&&!r(t)}},function(t,e,i){var r=i(5),n=i(45);t.exports=function(t){if(!n(t))return!1;var e=r(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e){t.exports=function(t,e){if(null==t)return{};var i,r,n={},s=Object.keys(t);for(r=0;r<s.length;r++)i=s[r],e.indexOf(i)>=0||(n[i]=t[i]);return n}},function(t,e){var i,r,n=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(t){i=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(t){r=o}}();var h,c=[],u=!1,l=-1;function d(){u&&h&&(u=!1,h.length?c=h.concat(c):l=-1,c.length&&f())}function f(){if(!u){var t=a(d);u=!0;for(var e=c.length;e;){for(h=c,c=[];++l<e;)h&&h[l].run();l=-1,e=c.length}h=null,u=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function y(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new p(t,e)),1!==c.length||u||a(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=y,n.addListener=y,n.once=y,n.off=y,n.removeListener=y,n.removeAllListeners=y,n.emit=y,n.prependListener=y,n.prependOnceListener=y,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e,i){"use strict";i.r(e),i.d(e,"Alpha",(function(){return Te})),i.d(e,"Attraction",(function(){return Se})),i.d(e,"Collision",(function(){return Ce})),i.d(e,"Color",(function(){return Ae})),i.d(e,"CrossZone",(function(){return je})),i.d(e,"Force",(function(){return Be})),i.d(e,"Gravity",(function(){return Re})),i.d(e,"RandomDrift",(function(){return Ve})),i.d(e,"Repulsion",(function(){return Ie})),i.d(e,"Rotate",(function(){return De})),i.d(e,"Scale",(function(){return ke})),i.d(e,"Spring",(function(){return Fe})),i.d(e,"Behaviour",(function(){return Pe})),i.d(e,"Debug",(function(){return Qe})),i.d(e,"log",(function(){return He})),i.d(e,"ease",(function(){return d})),i.d(e,"easeLinear",(function(){return f})),i.d(e,"easeInQuad",(function(){return p})),i.d(e,"easeOutQuad",(function(){return y})),i.d(e,"easeInOutQuad",(function(){return m})),i.d(e,"easeInCubic",(function(){return g})),i.d(e,"easeOutCubic",(function(){return x})),i.d(e,"easeInOutCubic",(function(){return v})),i.d(e,"easeInQuart",(function(){return b})),i.d(e,"easeOutQuart",(function(){return _})),i.d(e,"easeInOutQuart",(function(){return z})),i.d(e,"easeInSine",(function(){return w})),i.d(e,"easeOutSine",(function(){return M})),i.d(e,"easeInOutSine",(function(){return E})),i.d(e,"easeInExpo",(function(){return O})),i.d(e,"easeOutExpo",(function(){return P})),i.d(e,"easeInOutExpo",(function(){return T})),i.d(e,"easeInCirc",(function(){return S})),i.d(e,"easeOutCirc",(function(){return C})),i.d(e,"easeInOutCirc",(function(){return A})),i.d(e,"easeInBack",(function(){return j})),i.d(e,"easeOutBack",(function(){return B})),i.d(e,"easeInOutBack",(function(){return R})),i.d(e,"setEasingByName",(function(){return V})),i.d(e,"getEasingByName",(function(){return I})),i.d(e,"FollowEmitter",(function(){return We})),i.d(e,"Emitter",(function(){return Ee})),i.d(e,"Body",(function(){return It})),i.d(e,"BodySprite",(function(){return qt})),i.d(e,"InitializerUtil",(function(){return Xt})),i.d(e,"Life",(function(){return Jt})),i.d(e,"Mass",(function(){return Gt})),i.d(e,"Position",(function(){return de})),i.d(e,"Radius",(function(){return fe})),i.d(e,"Rate",(function(){return pe})),i.d(e,"Texture",(function(){return ge})),i.d(e,"VectorVelocity",(function(){return _e})),i.d(e,"PolarVelocity",(function(){return ve})),i.d(e,"RadialVelocity",(function(){return be})),i.d(e,"ArraySpan",(function(){return xt})),i.d(e,"createArraySpan",(function(){return vt})),i.d(e,"ColorSpan",(function(){return bt})),i.d(e,"createColorSpan",(function(){return _t})),i.d(e,"Box",(function(){return zt})),i.d(e,"integrate",(function(){return Tt})),i.d(e,"MathUtils",(function(){return ft})),i.d(e,"Polar3D",(function(){return Ct})),i.d(e,"Span",(function(){return pt})),i.d(e,"createSpan",(function(){return yt})),i.d(e,"Vector3D",(function(){return St})),i.d(e,"INTEGRATION_TYPE_EULER",(function(){return wt})),i.d(e,"INTEGRATION_TYPE_RK2",(function(){return Mt})),i.d(e,"INTEGRATION_TYPE_RK4",(function(){return Et})),i.d(e,"INTEGRATION_TYPE_VERLET",(function(){return Ot})),i.d(e,"CustomRenderer",(function(){return $e})),i.d(e,"MeshRenderer",(function(){return ti})),i.d(e,"SpriteRenderer",(function(){return ei})),i.d(e,"GPURenderer",(function(){return mi})),i.d(e,"ColorUtil",(function(){return $})),i.d(e,"PUID",(function(){return tt})),i.d(e,"THREEUtil",(function(){return ot})),i.d(e,"Util",(function(){return at})),i.d(e,"uid",(function(){return ct})),i.d(e,"withDefaults",(function(){return dt})),i.d(e,"BoxZone",(function(){return oe})),i.d(e,"LineZone",(function(){return ae})),i.d(e,"MeshZone",(function(){return he})),i.d(e,"PointZone",(function(){return ce})),i.d(e,"ScreenZone",(function(){return ue})),i.d(e,"SphereZone",(function(){return le})),i.d(e,"System",(function(){return Xe})),i.d(e,"Particle",(function(){return At})),i.d(e,"Pool",(function(){return jt}));var r={};i.r(r),i.d(r,"BoxZone",(function(){return oe})),i.d(r,"LineZone",(function(){return ae})),i.d(r,"MeshZone",(function(){return he})),i.d(r,"PointZone",(function(){return ce})),i.d(r,"ScreenZone",(function(){return ue})),i.d(r,"SphereZone",(function(){return le}));var n={};i.r(n),i.d(n,"Body",(function(){return It})),i.d(n,"BodySprite",(function(){return qt})),i.d(n,"InitializerUtil",(function(){return Xt})),i.d(n,"Life",(function(){return Jt})),i.d(n,"Mass",(function(){return Gt})),i.d(n,"Position",(function(){return de})),i.d(n,"Radius",(function(){return fe})),i.d(n,"Rate",(function(){return pe})),i.d(n,"Texture",(function(){return ge})),i.d(n,"VectorVelocity",(function(){return _e})),i.d(n,"PolarVelocity",(function(){return ve})),i.d(n,"RadialVelocity",(function(){return be}));var s={};i.r(s),i.d(s,"Alpha",(function(){return Te})),i.d(s,"Attraction",(function(){return Se})),i.d(s,"Collision",(function(){return Ce})),i.d(s,"Color",(function(){return Ae})),i.d(s,"CrossZone",(function(){return je})),i.d(s,"Force",(function(){return Be})),i.d(s,"Gravity",(function(){return Re})),i.d(s,"RandomDrift",(function(){return Ve})),i.d(s,"Repulsion",(function(){return Ie})),i.d(s,"Rotate",(function(){return De})),i.d(s,"Scale",(function(){return ke})),i.d(s,"Spring",(function(){return Fe})),i.d(s,"Behaviour",(function(){return Pe}));const o=["BodySprite","Texture"];var a=i(0);const h=3.142,c=500,u=h/180,l="euler",d={easeLinear:function(t){return t},easeInQuad:function(t){return Math.pow(t,2)},easeOutQuad:function(t){return-(Math.pow(t-1,2)-1)},easeInOutQuad:function(t){return(t/=.5)<1?.5*Math.pow(t,2):-.5*((t-=2)*t-2)},easeInCubic:function(t){return Math.pow(t,3)},easeOutCubic:function(t){return Math.pow(t-1,3)+1},easeInOutCubic:function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},easeInQuart:function(t){return Math.pow(t,4)},easeOutQuart:function(t){return-(Math.pow(t-1,4)-1)},easeInOutQuart:function(t){return(t/=.5)<1?.5*Math.pow(t,4):-.5*((t-=2)*Math.pow(t,3)-2)},easeInSine:function(t){return 1-Math.cos(t*(h/2))},easeOutSine:function(t){return Math.sin(t*(h/2))},easeInOutSine:function(t){return-.5*(Math.cos(h*t)-1)},easeInExpo:function(t){return 0===t?0:Math.pow(2,10*(t-1))},easeOutExpo:function(t){return 1===t?1:1-Math.pow(2,-10*t)},easeInOutExpo:function(t){return 0===t?0:1===t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},easeInCirc:function(t){return-(Math.sqrt(1-t*t)-1)},easeOutCirc:function(t){return Math.sqrt(1-Math.pow(t-1,2))},easeInOutCirc:function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},easeInBack:function(t){var e=1.70158;return t*t*((e+1)*t-e)},easeOutBack:function(t){var e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack:function(t){var e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)}},{easeLinear:f,easeInQuad:p,easeOutQuad:y,easeInOutQuad:m,easeInCubic:g,easeOutCubic:x,easeInOutCubic:v,easeInQuart:b,easeOutQuart:_,easeInOutQuart:z,easeInSine:w,easeOutSine:M,easeInOutSine:E,easeInExpo:O,easeOutExpo:P,easeInOutExpo:T,easeInCirc:S,easeOutCirc:C,easeInOutCirc:A,easeInBack:j,easeOutBack:B,easeInOutBack:R}=d,V=t=>d[t]?d[t]:d.easeLinear,I=t=>d[t]?d[t]:d.easeLinear,D=f,k=["Position","Life","Radius","Mass","Body","BodySprite","Texture","PolarVelocity","RadialVelocity","VectorVelocity"],F=["Alpha","Attraction","Color","CrossZone","Force","Gravity","RandomDrift","Repulsion","Rotate","Scale","Spring"],Z=(a.e,["BoxZone","LineZone","MeshZone","PointZone","SphereZone"]);var L,N,U,q,Y,X,J,G,Q,H,W=i(1),K=i.n(W),$={getRGB:function(t){var e={};if("number"==typeof t)r=Math.floor(t),e.r=(t>>16&255)/255,e.g=(t>>8&255)/255,e.b=(255&t)/255;else if("string"==typeof t){var i;if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(t))e.r=Math.min(255,parseInt(i[1],10))/255,e.g=Math.min(255,parseInt(i[2],10))/255,e.b=Math.min(255,parseInt(i[3],10))/255;else if(i=/^\#([A-Fa-f0-9]+)$/.exec(t)){var r=i[1];e.r=parseInt(r.charAt(0)+r.charAt(1),16)/255,e.g=parseInt(r.charAt(2)+r.charAt(3),16)/255,e.b=parseInt(r.charAt(4)+r.charAt(5),16)/255}}else e.r=t.r,e.g=t.g,e.b=t.b;return e}},tt={_id:0,_uids:new Map,getNewId:function(){return"PUID_".concat(this._id++)},id:function(t){if(this._uids.has(t))return this._uids.get(t);const e=this.getNewId();return this._uids.set(t,e),e}},et={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var t=[],e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);return function(){var e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&r|128]+t[r>>8&255]+"-"+t[r>>16&255]+t[r>>24&255]+t[255&n]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]).toUpperCase()}}(),clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,i,r,n){return r+(t-e)*(n-r)/(i-e)},lerp:function(t,e,i){return(1-i)*t+i*e},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*et.DEG2RAD},radToDeg:function(t){return t*et.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function it(t,e,i,r){this._x=t||0,this._y=e||0,this._z=i||0,this._w=void 0!==r?r:1}function rt(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0}function nt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function st(t,e,i,r){this._x=t||0,this._y=e||0,this._z=i||0,this._order=r||st.DefaultOrder}Object.assign(it,{slerp:function(t,e,i,r){return i.copy(t).slerp(e,r)},slerpFlat:function(t,e,i,r,n,s,o){var a=i[r+0],h=i[r+1],c=i[r+2],u=i[r+3],l=n[s+0],d=n[s+1],f=n[s+2],p=n[s+3];if(u!==p||a!==l||h!==d||c!==f){var y=1-o,m=a*l+h*d+c*f+u*p,g=m>=0?1:-1,x=1-m*m;if(x>Number.EPSILON){var v=Math.sqrt(x),b=Math.atan2(v,m*g);y=Math.sin(y*b)/v,o=Math.sin(o*b)/v}var _=o*g;if(a=a*y+l*_,h=h*y+d*_,c=c*y+f*_,u=u*y+p*_,y===1-o){var z=1/Math.sqrt(a*a+h*h+c*c+u*u);a*=z,h*=z,c*=z,u*=z}}t[e]=a,t[e+1]=h,t[e+2]=c,t[e+3]=u}}),Object.defineProperties(it.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(it.prototype,{isQuaternion:!0,set:function(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=t._x,r=t._y,n=t._z,s=t.order,o=Math.cos,a=Math.sin,h=o(i/2),c=o(r/2),u=o(n/2),l=a(i/2),d=a(r/2),f=a(n/2);return"XYZ"===s?(this._x=l*c*u+h*d*f,this._y=h*d*u-l*c*f,this._z=h*c*f+l*d*u,this._w=h*c*u-l*d*f):"YXZ"===s?(this._x=l*c*u+h*d*f,this._y=h*d*u-l*c*f,this._z=h*c*f-l*d*u,this._w=h*c*u+l*d*f):"ZXY"===s?(this._x=l*c*u-h*d*f,this._y=h*d*u+l*c*f,this._z=h*c*f+l*d*u,this._w=h*c*u-l*d*f):"ZYX"===s?(this._x=l*c*u-h*d*f,this._y=h*d*u+l*c*f,this._z=h*c*f-l*d*u,this._w=h*c*u+l*d*f):"YZX"===s?(this._x=l*c*u+h*d*f,this._y=h*d*u+l*c*f,this._z=h*c*f-l*d*u,this._w=h*c*u-l*d*f):"XZY"===s&&(this._x=l*c*u-h*d*f,this._y=h*d*u-l*c*f,this._z=h*c*f+l*d*u,this._w=h*c*u+l*d*f),!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){var i=e/2,r=Math.sin(i);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(i),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e,i=t.elements,r=i[0],n=i[4],s=i[8],o=i[1],a=i[5],h=i[9],c=i[2],u=i[6],l=i[10],d=r+a+l;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(u-h)*e,this._y=(s-c)*e,this._z=(o-n)*e):r>a&&r>l?(e=2*Math.sqrt(1+r-a-l),this._w=(u-h)/e,this._x=.25*e,this._y=(n+o)/e,this._z=(s+c)/e):a>l?(e=2*Math.sqrt(1+a-r-l),this._w=(s-c)/e,this._x=(n+o)/e,this._y=.25*e,this._z=(h+u)/e):(e=2*Math.sqrt(1+l-r-a),this._w=(o-n)/e,this._x=(s+c)/e,this._y=(h+u)/e,this._z=.25*e),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var i=t.dot(e)+1;return i<1e-6?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(et.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var i=this.angleTo(t);if(0===i)return this;var r=Math.min(1,e/i);return this.slerp(t,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var i=t._x,r=t._y,n=t._z,s=t._w,o=e._x,a=e._y,h=e._z,c=e._w;return this._x=i*c+s*o+r*h-n*a,this._y=r*c+s*a+n*o-i*h,this._z=n*c+s*h+i*a-r*o,this._w=s*c-i*o-r*a-n*h,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,r=this._y,n=this._z,s=this._w,o=s*t._w+i*t._x+r*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=i,this._y=r,this._z=n,this;var a=1-o*o;if(a<=Number.EPSILON){var h=1-e;return this._w=h*s+e*this._w,this._x=h*i+e*this._x,this._y=h*r+e*this._y,this._z=h*n+e*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(a),u=Math.atan2(c,o),l=Math.sin((1-e)*u)/c,d=Math.sin(e*u)/c;return this._w=s*l+this._w*d,this._x=i*l+this._x*d,this._y=r*l+this._y*d,this._z=n*l+this._z*d,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(rt.prototype,{isVector3:!0,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:(N=new it,function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(N.setFromEuler(t))}),applyAxisAngle:function(){var t=new it;return function(e,i){return this.applyQuaternion(t.setFromAxisAngle(e,i))}}(),applyMatrix3:function(t){var e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6]*r,this.y=n[1]*e+n[4]*i+n[7]*r,this.z=n[2]*e+n[5]*i+n[8]*r,this},applyMatrix4:function(t){var e=this.x,i=this.y,r=this.z,n=t.elements,s=1/(n[3]*e+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*e+n[4]*i+n[8]*r+n[12])*s,this.y=(n[1]*e+n[5]*i+n[9]*r+n[13])*s,this.z=(n[2]*e+n[6]*i+n[10]*r+n[14])*s,this},applyQuaternion:function(t){var e=this.x,i=this.y,r=this.z,n=t.x,s=t.y,o=t.z,a=t.w,h=a*e+s*r-o*i,c=a*i+o*e-n*r,u=a*r+n*i-s*e,l=-n*e-s*i-o*r;return this.x=h*a+l*-n+c*-o-u*-s,this.y=c*a+l*-s+u*-n-h*-o,this.z=u*a+l*-o+h*-s-c*-n,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*r,this.y=n[1]*e+n[5]*i+n[9]*r,this.z=n[2]*e+n[6]*i+n[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var i=t.x,r=t.y,n=t.z,s=e.x,o=e.y,a=e.z;return this.x=r*a-n*o,this.y=n*s-i*a,this.z=i*o-r*s,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:(L=new rt,function(t){return L.copy(this).projectOnVector(t),this.sub(L)}),reflect:function(){var t=new rt;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(et.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,i){var r=Math.sin(e)*t;return this.x=r*Math.sin(i),this.y=Math.cos(e)*t,this.z=r*Math.cos(i),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=r,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),Object.assign(nt.prototype,{isMatrix4:!0,set:function(t,e,i,r,n,s,o,a,h,c,u,l,d,f,p,y){var m=this.elements;return m[0]=t,m[4]=e,m[8]=i,m[12]=r,m[1]=n,m[5]=s,m[9]=o,m[13]=a,m[2]=h,m[6]=c,m[10]=u,m[14]=l,m[3]=d,m[7]=f,m[11]=p,m[15]=y,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new nt).fromArray(this.elements)},copy:function(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},copyPosition:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this},extractBasis:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this},extractRotation:function(){var t=new rt;return function(e){var i=this.elements,r=e.elements,n=1/t.setFromMatrixColumn(e,0).length(),s=1/t.setFromMatrixColumn(e,1).length(),o=1/t.setFromMatrixColumn(e,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=0,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[7]=0,i[8]=r[8]*o,i[9]=r[9]*o,i[10]=r[10]*o,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}}(),makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,i=t.x,r=t.y,n=t.z,s=Math.cos(i),o=Math.sin(i),a=Math.cos(r),h=Math.sin(r),c=Math.cos(n),u=Math.sin(n);if("XYZ"===t.order){var l=s*c,d=s*u,f=o*c,p=o*u;e[0]=a*c,e[4]=-a*u,e[8]=h,e[1]=d+f*h,e[5]=l-p*h,e[9]=-o*a,e[2]=p-l*h,e[6]=f+d*h,e[10]=s*a}else if("YXZ"===t.order){var y=a*c,m=a*u,g=h*c,x=h*u;e[0]=y+x*o,e[4]=g*o-m,e[8]=s*h,e[1]=s*u,e[5]=s*c,e[9]=-o,e[2]=m*o-g,e[6]=x+y*o,e[10]=s*a}else if("ZXY"===t.order){y=a*c,m=a*u,g=h*c,x=h*u;e[0]=y-x*o,e[4]=-s*u,e[8]=g+m*o,e[1]=m+g*o,e[5]=s*c,e[9]=x-y*o,e[2]=-s*h,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){l=s*c,d=s*u,f=o*c,p=o*u;e[0]=a*c,e[4]=f*h-d,e[8]=l*h+p,e[1]=a*u,e[5]=p*h+l,e[9]=d*h-f,e[2]=-h,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){var v=s*a,b=s*h,_=o*a,z=o*h;e[0]=a*c,e[4]=z-v*u,e[8]=_*u+b,e[1]=u,e[5]=s*c,e[9]=-o*c,e[2]=-h*c,e[6]=b*u+_,e[10]=v-z*u}else if("XZY"===t.order){v=s*a,b=s*h,_=o*a,z=o*h;e[0]=a*c,e[4]=-u,e[8]=h*c,e[1]=v*u+z,e[5]=s*c,e[9]=b*u-_,e[2]=_*u-b,e[6]=o*c,e[10]=z*u+v}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:(G=new rt(0,0,0),Q=new rt(1,1,1),function(t){return this.compose(G,t,Q)}),lookAt:(Y=new rt,X=new rt,J=new rt,function(t,e,i){var r=this.elements;return J.subVectors(t,e),0===J.lengthSq()&&(J.z=1),J.normalize(),Y.crossVectors(i,J),0===Y.lengthSq()&&(1===Math.abs(i.z)?J.x+=1e-4:J.z+=1e-4,J.normalize(),Y.crossVectors(i,J)),Y.normalize(),X.crossVectors(J,Y),r[0]=Y.x,r[4]=X.x,r[8]=J.x,r[1]=Y.y,r[5]=X.y,r[9]=J.y,r[2]=Y.z,r[6]=X.z,r[10]=J.z,this}),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.elements,r=e.elements,n=this.elements,s=i[0],o=i[4],a=i[8],h=i[12],c=i[1],u=i[5],l=i[9],d=i[13],f=i[2],p=i[6],y=i[10],m=i[14],g=i[3],x=i[7],v=i[11],b=i[15],_=r[0],z=r[4],w=r[8],M=r[12],E=r[1],O=r[5],P=r[9],T=r[13],S=r[2],C=r[6],A=r[10],j=r[14],B=r[3],R=r[7],V=r[11],I=r[15];return n[0]=s*_+o*E+a*S+h*B,n[4]=s*z+o*O+a*C+h*R,n[8]=s*w+o*P+a*A+h*V,n[12]=s*M+o*T+a*j+h*I,n[1]=c*_+u*E+l*S+d*B,n[5]=c*z+u*O+l*C+d*R,n[9]=c*w+u*P+l*A+d*V,n[13]=c*M+u*T+l*j+d*I,n[2]=f*_+p*E+y*S+m*B,n[6]=f*z+p*O+y*C+m*R,n[10]=f*w+p*P+y*A+m*V,n[14]=f*M+p*T+y*j+m*I,n[3]=g*_+x*E+v*S+b*B,n[7]=g*z+x*O+v*C+b*R,n[11]=g*w+x*P+v*A+b*V,n[15]=g*M+x*T+v*j+b*I,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new rt;return function(e){for(var i=0,r=e.count;i<r;i++)t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.applyMatrix4(this),e.setXYZ(i,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],i=t[4],r=t[8],n=t[12],s=t[1],o=t[5],a=t[9],h=t[13],c=t[2],u=t[6],l=t[10],d=t[14];return t[3]*(+n*a*u-r*h*u-n*o*l+i*h*l+r*o*d-i*a*d)+t[7]*(+e*a*d-e*h*l+n*s*l-r*s*d+r*h*c-n*a*c)+t[11]*(+e*h*u-e*o*d-n*s*u+i*s*d+n*o*c-i*h*c)+t[15]*(-r*o*c-e*a*u+e*o*l+r*s*u-i*s*l+i*a*c)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t,e,i){var r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=i),this},getInverse:function(t,e){var i=this.elements,r=t.elements,n=r[0],s=r[1],o=r[2],a=r[3],h=r[4],c=r[5],u=r[6],l=r[7],d=r[8],f=r[9],p=r[10],y=r[11],m=r[12],g=r[13],x=r[14],v=r[15],b=f*x*l-g*p*l+g*u*y-c*x*y-f*u*v+c*p*v,_=m*p*l-d*x*l-m*u*y+h*x*y+d*u*v-h*p*v,z=d*g*l-m*f*l+m*c*y-h*g*y-d*c*v+h*f*v,w=m*f*u-d*g*u-m*c*p+h*g*p+d*c*x-h*f*x,M=n*b+s*_+o*z+a*w;if(0===M){var E="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(E);return console.warn(E),this.identity()}var O=1/M;return i[0]=b*O,i[1]=(g*p*a-f*x*a-g*o*y+s*x*y+f*o*v-s*p*v)*O,i[2]=(c*x*a-g*u*a+g*o*l-s*x*l-c*o*v+s*u*v)*O,i[3]=(f*u*a-c*p*a-f*o*l+s*p*l+c*o*y-s*u*y)*O,i[4]=_*O,i[5]=(d*x*a-m*p*a+m*o*y-n*x*y-d*o*v+n*p*v)*O,i[6]=(m*u*a-h*x*a-m*o*l+n*x*l+h*o*v-n*u*v)*O,i[7]=(h*p*a-d*u*a+d*o*l-n*p*l-h*o*y+n*u*y)*O,i[8]=z*O,i[9]=(m*f*a-d*g*a-m*s*y+n*g*y+d*s*v-n*f*v)*O,i[10]=(h*g*a-m*c*a+m*s*l-n*g*l-h*s*v+n*c*v)*O,i[11]=(d*c*a-h*f*a-d*s*l+n*f*l+h*s*y-n*c*y)*O,i[12]=w*O,i[13]=(d*g*o-m*f*o+m*s*p-n*g*p-d*s*x+n*f*x)*O,i[14]=(m*c*o-h*g*o-m*s*u+n*g*u+h*s*x-n*c*x)*O,i[15]=(h*f*o-d*c*o+d*s*u-n*f*u-h*s*p+n*c*p)*O,this},scale:function(t){var e=this.elements,i=t.x,r=t.y,n=t.z;return e[0]*=i,e[4]*=r,e[8]*=n,e[1]*=i,e[5]*=r,e[9]*=n,e[2]*=i,e[6]*=r,e[10]*=n,e[3]*=i,e[7]*=r,e[11]*=n,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))},makeTranslation:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var i=Math.cos(e),r=Math.sin(e),n=1-i,s=t.x,o=t.y,a=t.z,h=n*s,c=n*o;return this.set(h*s+i,h*o-r*a,h*a+r*o,0,h*o+r*a,c*o+i,c*a-r*s,0,h*a-r*o,c*a+r*s,n*a*a+i,0,0,0,0,1),this},makeScale:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,i){var r=this.elements,n=e._x,s=e._y,o=e._z,a=e._w,h=n+n,c=s+s,u=o+o,l=n*h,d=n*c,f=n*u,p=s*c,y=s*u,m=o*u,g=a*h,x=a*c,v=a*u,b=i.x,_=i.y,z=i.z;return r[0]=(1-(p+m))*b,r[1]=(d+v)*b,r[2]=(f-x)*b,r[3]=0,r[4]=(d-v)*_,r[5]=(1-(l+m))*_,r[6]=(y+g)*_,r[7]=0,r[8]=(f+x)*z,r[9]=(y-g)*z,r[10]=(1-(l+p))*z,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},decompose:(U=new rt,q=new nt,function(t,e,i){var r=this.elements,n=U.set(r[0],r[1],r[2]).length(),s=U.set(r[4],r[5],r[6]).length(),o=U.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),t.x=r[12],t.y=r[13],t.z=r[14],q.copy(this);var a=1/n,h=1/s,c=1/o;return q.elements[0]*=a,q.elements[1]*=a,q.elements[2]*=a,q.elements[4]*=h,q.elements[5]*=h,q.elements[6]*=h,q.elements[8]*=c,q.elements[9]*=c,q.elements[10]*=c,e.setFromRotationMatrix(q),i.x=n,i.y=s,i.z=o,this}),makePerspective:function(t,e,i,r,n,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,a=2*n/(e-t),h=2*n/(i-r),c=(e+t)/(e-t),u=(i+r)/(i-r),l=-(s+n)/(s-n),d=-2*s*n/(s-n);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=h,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=l,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,e,i,r,n,s){var o=this.elements,a=1/(e-t),h=1/(i-r),c=1/(s-n),u=(e+t)*a,l=(i+r)*h,d=(s+n)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-l,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,i=t.elements,r=0;r<16;r++)if(e[r]!==i[r])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var i=0;i<16;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}),st.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],st.DefaultOrder="XYZ",Object.defineProperties(st.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(st.prototype,{isEuler:!0,set:function(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,i){var r=et.clamp,n=t.elements,s=n[0],o=n[4],a=n[8],h=n[1],c=n[5],u=n[9],l=n[2],d=n[6],f=n[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,c),this._z=0)):"YXZ"===e?(this._x=Math.asin(-r(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(a,f),this._z=Math.atan2(h,c)):(this._y=Math.atan2(-l,s),this._z=0)):"ZXY"===e?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-l,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(h,s))):"ZYX"===e?(this._y=Math.asin(-r(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(d,f),this._z=Math.atan2(h,s)):(this._x=0,this._z=Math.atan2(-o,c))):"YZX"===e?(this._z=Math.asin(r(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-l,s)):(this._x=0,this._y=Math.atan2(a,f))):"XZY"===e?(this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==i&&this._onChangeCallback(),this},setFromQuaternion:function(){var t=new nt;return function(e,i,r){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,i,r)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:(H=new it,function(t){return H.setFromEuler(this),this.setFromQuaternion(H,t)}),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new rt(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var ot={toScreenPos:function(){var t=new rt;return function(e,i,r){return t.copy(e),t.project(i),t.x=Math.round((t.x+1)*r.width/2),t.y=Math.round((1-t.y)*r.height/2),t.z=0,t}}(),toSpacePos:function(){var t,e=new rt,i=new rt;return function(r,n,s){return e.set(r.x/s.width*2-1,-r.y/s.height*2+1,.5),e.unproject(n),i.copy(e.sub(n.position).normalize()),t=-n.position.z/i.z,e.copy(n.position),e.add(i.multiplyScalar(t)),e}}()},at={initValue:function(t,e){return null!=t&&null!=t?t:e},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},destroyArray:function(t){t.length=0},destroyObject:function(t){for(var e in t)delete t[e]},isUndefined:function(){for(var t in arguments){var e=arguments[t];if(void 0!==e)return!1}return!0},setVectorByObj:function(t,e){void 0!==e.x&&(t.position.x=e.x),void 0!==e.y&&(t.position.y=e.y),void 0!==e.z&&(t.position.z=e.z),void 0!==e.vx&&(t.velocity.x=e.vx),void 0!==e.vy&&(t.velocity.y=e.vy),void 0!==e.vz&&(t.velocity.z=e.vz),void 0!==e.ax&&(t.acceleration.x=e.ax),void 0!==e.ay&&(t.acceleration.y=e.ay),void 0!==e.az&&(t.acceleration.z=e.az),void 0!==e.p&&t.position.copy(e.p),void 0!==e.v&&t.velocity.copy(e.v),void 0!==e.a&&t.acceleration.copy(e.a),void 0!==e.position&&t.position.copy(e.position),void 0!==e.velocity&&t.velocity.copy(e.velocity),void 0!==e.accelerate&&t.acceleration.copy(e.accelerate)},setPrototypeByObj:function(t,e,i){for(var r in e)t.hasOwnProperty(r)&&(i?i.indexOf(r)<0&&(t[r]=this._getValue(e[r])):t[r]=this._getValue(e[r]));return t},_getValue:function(t){return"Span"===t.constructor.type?t.getValue():t}},ht=i(15),ct=i.n(ht).a;function ut(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function lt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ut(Object(i),!0).forEach((function(e){K()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ut(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}const dt=(t,e)=>lt(lt({},t),e);var ft={randomAToB:function(t,e,i){return i?(Math.random()*(e-t)>>0)+t:t+Math.random()*(e-t)},randomFloating:function(t,e,i){return this.randomAToB(t-e,t+e,i)},randomZone:function(t){},degreeTransform:function(t){return t*h/180},toColor16:function(t){return"#"+t.toString(16)},randomColor:function(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).slice(-6)},lerp:function(t,e,i){return e+(t-e)*i},getNormal:function(t,e){return 0==t.x&&0==t.y?0==t.z?e.set(1,0,1):e.set(1,1,-t.y/t.z):0==t.x?e.set(1,0,1):e.set(-t.y/t.x,1,1),e.normalize()},axisRotate:function(t,e,i,r){var n=Math.cos(r),s=Math.sin(r),o=i.dot(e)*(1-n);t.copy(i),t.cross(e).scalar(s),t.addValue(e.x*n,e.y*n,e.z*n),t.addValue(i.x*o,i.y*o,i.z*o)}};class pt{constructor(t,e,i){this._isArray=!1,this.type="Span",at.isArray(t)?(this._isArray=!0,this.a=t):(this.a=at.initValue(t,1),this.b=at.initValue(e,this.a),this._center=at.initValue(i,!1))}getValue(t){return this._isArray?this.a[this.a.length*Math.random()>>0]:this._center?ft.randomFloating(this.a,this.b,t):ft.randomAToB(this.a,this.b,t)}}const yt=(t,e,i)=>t instanceof pt?t:void 0===e?new pt(t):void 0===i?new pt(t,e):new pt(t,e,i);var mt=i(7),gt=i.n(mt);class xt extends pt{constructor(t){super(),this.type="ArraySpan",this.items=Array.isArray(t)?t:[t]}getValue(){return gt()(this.items)}}const vt=t=>t?t instanceof xt?t:new xt(t):null;class bt extends pt{constructor(t){super(),this.type="ColorSpan",this.shouldRandomize="random"===t,this.colors=Array.isArray(t)?t:[t]}getValue(){return this.shouldRandomize?ft.randomColor():gt()(this.colors)}}const _t=t=>(t||(console.warn("Invalid colors argument ".concat(t," passed to createColorSpan. Defaulting to 'random'.")),t="random"),t instanceof bt?t:new bt(t));class zt{constructor(t,e,i,r,n,s){this.type="Box",this.x=t,this.y=e,this.z=i,this.width=r,this.height=n,this.depth=s,this.bottom=this.y+this.height,this.right=this.x+this.width,this.right=this.x+this.width}contains(t,e,i){return t<=this.right&&t>=this.x&&e<=this.bottom&&e>=this.y&&i<=this.depth&&i>=this.z}}const wt="EULER",Mt="RUNGE_KUTTA_2",Et="RUNGE_KUTTA_4",Ot="VERLET",Pt=(t,e,i)=>{t.sleep||(t.old.position.copy(t.position),t.old.velocity.copy(t.velocity),t.acceleration.scalar(1/t.mass),t.velocity.add(t.acceleration.scalar(e)),t.position.add(t.old.velocity.scalar(e)),i&&t.velocity.scalar(i),t.acceleration.clear())},Tt=(t,e,i,r=wt)=>{switch(r){case wt:Pt(t,e,i);break;default:Pt(t,e,i)}};class St extends rt{clear(){return this.x=0,this.y=0,this.z=0,this}scalar(t){return this.x*=t,this.y*=t,this.z*=t,this}addValue(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}toString(){return"x:"+this.x+"y:"+this.y+"z:"+this.z}eulerFromDir(t){return(new st).setFromVector3(t)}}class Ct{constructor(t,e,i){this.type="Polar3D",this.radius=t||1,this.phi=i||0,this.theta=e||0}set(t,e,i){return this.radius=t||1,this.phi=i||0,this.theta=e||0,this}setRadius(t){return this.radius=t,this}setPhi(t){return this.phi=t,this}setTheta(t){return this.theta=t,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}toVector3D(){return new St(this.getX(),this.getY(),this.getZ())}getX(){return this.radius*Math.sin(this.theta)*Math.cos(this.phi)}getY(){return-this.radius*Math.sin(this.theta)*Math.sin(this.phi)}getZ(){return this.radius*Math.cos(this.theta)}normalize(){return this.radius=1,this}equals(t){return t.radius===this.radius&&t.phi===this.phi&&t.theta===this.theta}clear(){return this.radius=0,this.phi=0,this.theta=0,this}clone(){return new Ct(this.radius,this.phi,this.theta)}}class At{constructor(t){this.id="particle-".concat(ct()),this.type="Particle",this.life=1/0,this.age=0,this.energy=1,this.dead=!1,this.sleep=!1,this.body=null,this.parent=null,this.mass=1,this.radius=10,this.alpha=1,this.scale=1,this.useColor=!1,this.useAlpha=!1,this.easing=D,this.position=new St,this.velocity=new St,this.acceleration=new St,this.old={},this.old.position=this.position.clone(),this.old.velocity=this.velocity.clone(),this.old.acceleration=this.acceleration.clone(),this.behaviours=[],this.transform={},this.color={r:0,g:0,b:0},this.rotation=new St,this.distanceToCamera=0,at.setPrototypeByObj(this,t)}getDirection(){return Math.atan2(this.velocity.x,-this.velocity.y)*(180/h)}reset(){return this.life=1/0,this.age=0,this.energy=1,this.dead=!1,this.sleep=!1,this.body=null,this.parent=null,this.mass=1,this.radius=10,this.alpha=1,this.scale=1,this.useColor=!1,this.useAlpha=!1,this.easing=D,this.position.set(0,0,0),this.velocity.set(0,0,0),this.acceleration.set(0,0,0),this.old.position.set(0,0,0),this.old.velocity.set(0,0,0),this.old.acceleration.set(0,0,0),this.color.r=0,this.color.g=0,this.color.b=0,this.rotation.clear(),at.destroyObject(this.transform),this.removeAllBehaviours(),this}update(t,e){if(!this.sleep){this.age+=t;let i=this.behaviours.length;for(;i--;){let r=this.behaviours[i];r&&r.applyBehaviour(this,t,e)}}if(this.age>=this.life)this.destroy();else{const t=this.easing(this.age/this.life);this.energy=Math.max(1-t,0)}}addBehaviour(t){this.behaviours.push(t),t.initialize(this)}addBehaviours(t){let e=t.length;for(;e--;)this.addBehaviour(t[e])}removeBehaviour(t){const e=this.behaviours.indexOf(t);e>-1&&this.behaviours.splice(e,1)}removeAllBehaviours(){at.destroyArray(this.behaviours)}destroy(){this.removeAllBehaviours(),this.energy=0,this.dead=!0,this.parent=null}}class jt{constructor(){this.type="Pool",this.cID=0,this.list={}}create(t,...e){if(!this.canCreateNewObject(t))throw new Error("The pool is unable to create or clone the object supplied");return this.cID++,this.canInstantiateObject(t)?new t(...e):this.canCloneObject(t)?t.clone():void 0}canInstantiateObject(t){return"function"==typeof t}canCloneObject(t){return t.clone&&"function"==typeof t.clone}canCreateNewObject(t){return!(!this.canInstantiateObject(t)&&!this.canCloneObject(t))}getCount(){var t=0;for(var e in this.list)t+=this.list[e].length;return t++}get(t,...e){var i,r=t.__puid||tt.id(t);return(i=this.list[r]&&this.list[r].length>0?this.list[r].pop():this.create(t,...e)).__puid=t.__puid||r,i}expire(t){return this._getList(t.__puid).push(t)}destroy(){for(var t in this.list)this.list[t].length=0,delete this.list[t]}_getList(t){return t=t||"default",this.list[t]||(this.list[t]=[]),this.list[t]}}var Bt=i(2),Rt=class{constructor(){this.listeners=null}set listeners(t){this._listeners=t}get listeners(){return this._listeners}addEventListener(t,e){return this.listeners?this.removeEventListener(t,e):this.listeners={},this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e),e}removeEventListener(t,e){if(this.listeners&&this.listeners[t])for(var i=this.listeners[t],r=0,n=i.length;r<n;r++)if(i[r]==e){1==n?delete this.listeners[t]:i.splice(r,1);break}}removeAllEventListeners(t){t?this.listeners&&delete this.listeners[t]:this.listeners=null}dispatchEvent(t,e){var i=!1,r=this.listeners;if(t&&r){var n=r[t];if(!n)return i;for(var s,o=(n=n.slice()).length;o--;)s=n[o],i=i||s(e)}return!!i}hasEventListener(t){var e=this.listeners;return!(!e||!e[t])}};class Vt{constructor(t="Initializer",e=!0){this.type=t,this.isEnabled=e}init(t,e){this.isEnabled&&(e?(this.initialize(e),e.hasBeenInitialized=!0):(this.initialize(t),t.hasBeenInitialized=!0))}reset(){}initialize(t){}static requiresWebGlApi(){return!1}static fromJSON(t){}}class It extends Vt{constructor(t,e,i,r=!0){super("Body",r),this.body=vt(t),this.w=e,this.h=i||e}initialize(t){var e=this.body.getValue();this.w?t.body={width:this.w,height:this.h,body:e}:t.body=e}static fromJSON(t){const{body:e,width:i,height:r,isEnabled:n=!0}=t;return new It(e,i,r,n)}}function Dt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function kt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Dt(Object(i),!0).forEach((function(e){K()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Dt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}const Ft={AdditiveBlending:2,CustomBlending:5,MultiplyBlending:4,NoBlending:0,NormalBlending:1,SubtractiveBlending:3},Zt={color:16711680,blending:2,fog:!0},Lt=kt(kt({},Zt),{},{blending:"AdditiveBlending"});function Nt(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function Ut(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Nt(Object(i),!0).forEach((function(e){K()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Nt(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}class qt extends Vt{constructor(t,e,i=Zt,r=!0){super("BodySprite",r);const{Sprite:n,SpriteMaterial:s,TextureLoader:o}=t;this.materialProperties=dt(Zt,i),(new o).load(e,t=>{this.texture=t,this.material=new s(Ut(Ut({},{map:t}),this.materialProperties)),this.sprite=new n(this.material)},void 0,t=>{throw new Error(t)})}initialize(t){t.body=this.sprite}static fromJSON(t,e){const{texture:i,materialProperties:r=Lt,isEnabled:n=!0}=t;return new qt(e,i,dt(Lt,(t=>{const{blending:e}=t;return Ut(Ut({},t),{},{blending:e?Ft[e]:Ft[Lt.blending]})})(r)),n)}}const Yt=new st;var Xt={particleEuler:null,initialize:function(t,e,i){let r=i.length;for(;r--;)i[r].init(t,e);t.bindEmitter&&this.bindEmitter(t,e)},bindEmitter:function(t,e){const{rotation:{x:i,y:r,z:n}}=t;e.position.add(t.position),e.velocity.add(t.velocity),e.acceleration.add(t.acceleration),e.velocity.applyEuler(Yt.set(i,r,n))}};class Jt extends Vt{constructor(t,e,i,r=!0){super("Life",r),this.lifePan=yt(t,e,i)}initialize(t){this.lifePan.a==1/0||"infi"==this.lifePan.a?t.life=1/0:t.life=this.lifePan.getValue()}static fromJSON(t){const{min:e,max:i,center:r=!1,isEnabled:n=!0}=t;return new Jt(e,i,r,n)}}class Gt extends Vt{constructor(t,e,i=!1,r=!0){super("Mass",r),this.massPan=yt(t,e,i)}initialize(t){t.mass=this.massPan.getValue()}static fromJSON(t){const{min:e,max:i,center:r=!1,isEnabled:n=!0}=t;return new Gt(e,i,r,n)}}var Qt,Ht,Wt,Kt,$t,te,ee,ie,re=i(16),ne=i.n(re);class se{constructor(t="Zone"){this.type=t,this.vector=new St(0,0,0),this.random=0,this.crossType="dead",this.log=!0,this.supportsCrossing=!0}getPosition(){return null}crossing(t){if(!this.supportsCrossing)return console.warn("".concat(this.constructor.name," does not support the crossing method"));switch(this.crossType){case"bound":this._bound(t);break;case"cross":this._cross(t);break;case"dead":this._dead(t)}}isBoxZone(){return!1}isLineZone(){return!1}isMeshZone(){return!1}isPointZone(){return!1}isScreenZone(){return!1}isSphereZone(){return!1}_dead(t){}_bound(t){}_cross(t){}}class oe extends se{constructor(t,e,i,r,n,s){var o,a,h,c,u;super("BoxZone"),at.isUndefined(e,i,r,n,s)?(o=a=h=0,c=u=r=t||100):at.isUndefined(r,n,s)?(o=a=h=0,c=t,u=e,r=i):(o=t,a=e,h=i,c=r,u=n,r=s),this.x=o,this.y=a,this.z=h,this.width=c,this.height=u,this.depth=r,this.friction=.85,this.max=6}isBoxZone(){return!0}getPosition(){return this.vector.x=this.x+ft.randomAToB(-.5,.5)*this.width,this.vector.y=this.y+ft.randomAToB(-.5,.5)*this.height,this.vector.z=this.z+ft.randomAToB(-.5,.5)*this.depth,this.vector}_dead(t){(t.position.x+t.radius<this.x-this.width/2||t.position.x-t.radius>this.x+this.width/2)&&(t.dead=!0),(t.position.y+t.radius<this.y-this.height/2||t.position.y-t.radius>this.y+this.height/2)&&(t.dead=!0),(t.position.z+t.radius<this.z-this.depth/2||t.position.z-t.radius>this.z+this.depth/2)&&(t.dead=!0)}_bound(t){t.position.x-t.radius<this.x-this.width/2?(t.position.x=this.x-this.width/2+t.radius,t.velocity.x*=-this.friction,this._static(t,"x")):t.position.x+t.radius>this.x+this.width/2&&(t.position.x=this.x+this.width/2-t.radius,t.velocity.x*=-this.friction,this._static(t,"x")),t.position.y-t.radius<this.y-this.height/2?(t.position.y=this.y-this.height/2+t.radius,t.velocity.y*=-this.friction,this._static(t,"y")):t.position.y+t.radius>this.y+this.height/2&&(t.position.y=this.y+this.height/2-t.radius,t.velocity.y*=-this.friction,this._static(t,"y")),t.position.z-t.radius<this.z-this.depth/2?(t.position.z=this.z-this.depth/2+t.radius,t.velocity.z*=-this.friction,this._static(t,"z")):t.position.z+t.radius>this.z+this.depth/2&&(t.position.z=this.z+this.depth/2-t.radius,t.velocity.z*=-this.friction,this._static(t,"z"))}_static(t,e){t.velocity[e]*t.acceleration[e]>0||Math.abs(t.velocity[e])<.0167*Math.abs(t.acceleration[e])*this.max&&(t.velocity[e]=0,t.acceleration[e]=0)}_cross(t){t.position.x+t.radius<this.x-this.width/2&&t.velocity.x<=0?t.position.x=this.x+this.width/2+t.radius:t.position.x-t.radius>this.x+this.width/2&&t.velocity.x>=0&&(t.position.x=this.x-this.width/2-t.radius),t.position.y+t.radius<this.y-this.height/2&&t.velocity.y<=0?t.position.y=this.y+this.height/2+t.radius:t.position.y-t.radius>this.y+this.height/2&&t.velocity.y>=0&&(t.position.y=this.y-this.height/2-t.radius),t.position.z+t.radius<this.z-this.depth/2&&t.velocity.z<=0?t.position.z=this.z+this.depth/2+t.radius:t.position.z-t.radius>this.z+this.depth/2&&t.velocity.z>=0&&(t.position.z=this.z-this.depth/2-t.radius)}}class ae extends se{constructor(t,e,i,r,n,s){super("LineZone"),t instanceof St?(this.x1=t.x,this.y1=t.y,this.z1=t.z,this.x2=r.x,this.y2=r.y,this.z2=r.z):(this.x1=t,this.y1=e,this.z1=i,this.x2=r,this.y2=n,this.z2=s),this.supportsCrossing=!1}isLineZone(){return!0}getPosition(){return this.random=Math.random(),this.vector.x=this.x1+this.random*(this.x2-this.x1),this.vector.y=this.y1+this.random*(this.y2-this.y1),this.vector.z=this.z1+this.random*(this.z2-this.z1),this.vector}}class he extends se{constructor(t,e=1,i){if(super("MeshZone"),this.geometry=null,this.scale=e,this.supportsCrossing=!1,t.type&&"Geometry"===t.type&&(this.geometry=t),t.geometry&&(this.geometry=t.geometry),!this.geometry)throw new Error("MeshZone unable to set geometry from the supplied bounds");this.geometry.isBufferGeometry&&(this.geometry=(new i).fromBufferGeometry(this.geometry))}isMeshZone(){return!0}getPosition(){const t=this.geometry.vertices,e=t[t.length*Math.random()>>0];return this.vector.x=e.x*this.scale,this.vector.y=e.y*this.scale,this.vector.z=e.z*this.scale,this.vector}}class ce extends se{constructor(t,e,i){var r;super("PointZone"),at.isUndefined(t,e,i)?r=0:(r=t,e),this.x=r,this.y=r,this.z=r,this.supportsCrossing=!1}isPointZone(){return!0}getPosition(){return this.vector.x=this.x,this.vector.y=this.y,this.vector.z=this.z,this.vector}}class ue extends se{constructor(t,e,i,r){super("ScreenZone"),this.camera=t,this.renderer=e,this.dis=i||20,r=r||"1234";for(var n=1;n<5;n++)this["d"+n]=r.indexOf(n+"")>=0}isScreenZone(){return!0}_dead(t){var e=ot.toScreenPos(t.position,this.camera,this.renderer.domElement),i=this.renderer.domElement;(e.y+t.radius<-this.dis&&this.d1||e.y-t.radius>i.height+this.dis&&this.d3)&&(t.dead=!0),(e.x+t.radius<-this.dis&&this.d4||e.x-t.radius>i.width+this.dis&&this.d2)&&(t.dead=!0)}_bound(t){var e=ot.toScreenPos(t.position,this.camera,this.renderer.domElement),i=this.renderer.domElement;(e.y+t.radius<-this.dis||e.y-t.radius>i.height+this.dis)&&(t.velocity.y*=-1),(e.x+t.radius<-this.dis||e.x-t.radius>i.width+this.dis)&&(t.velocity.y*=-1)}}ue.prototype.getPosition=(Ht=new St,function(){return Qt=this.renderer.domElement,Ht.x=Math.random()*Qt.width,Ht.y=Math.random()*Qt.height,this.vector.copy(ot.toSpacePos(Ht,this.camera,Qt)),this.vector}),ue.prototype._cross=function(){var t=new St;return function(e){var i=ot.toScreenPos(e.position,this.camera,this.renderer.domElement),r=this.renderer.domElement;i.y+e.radius<-this.dis?(t.x=i.x,t.y=r.height+this.dis+e.radius,e.position.y=ot.toSpacePos(t,this.camera,r).y):i.y-e.radius>r.height+this.dis&&(t.x=i.x,t.y=-this.dis-e.radius,e.position.y=ot.toSpacePos(t,this.camera,r).y),i.x+e.radius<-this.dis?(t.y=i.y,t.x=r.width+this.dis+e.radius,e.position.x=ot.toSpacePos(t,this.camera,r).x):i.x-e.radius>r.width+this.dis&&(t.y=i.y,t.x=-this.dis-e.radius,e.position.x=ot.toSpacePos(t,this.camera,r).x)}}();class le extends se{constructor(t,e,i,r){let n,s,o,a;super("SphereZone"),at.isUndefined(e,i,r)?(n=s=o=0,a=t||100):(n=t,s=e,o=i,a=r),this.x=n,this.y=n,this.z=n,this.radius=a,this.the=this.phi=0}isSphereZone(){return!0}_dead(t){t.position.distanceTo(this)-t.radius>this.radius&&(t.dead=!0)}_cross(){console.warn("".concat(this.constructor.name," does not support the _cross method"))}}le.prototype.getPosition=function(){return this.random=Math.random(),$t=this.random*this.radius,Wt=h*Math.random(),Kt=2*h*Math.random(),this.vector.x=this.x+$t*Math.sin(Wt)*Math.cos(Kt),this.vector.y=this.y+$t*Math.sin(Kt)*Math.sin(Wt),this.vector.z=this.z+$t*Math.cos(Wt),this.vector},le.prototype._bound=(ee=new St,ie=new St,function(t){t.position.distanceTo(this)+t.radius>=this.radius&&(ee.copy(t.position).sub(this).normalize(),ie.copy(t.velocity),te=2*ie.dot(ee),t.velocity.sub(ee.scalar(te)))});class de extends Vt{constructor(){super("Position"),this.reset.apply(this,arguments)}reset(){this.zones?this.zones.length=0:this.zones=[],this.zones=this.zones.concat(Array.prototype.slice.call(arguments))}addZone(){this.zones=this.zones.concat(Array.prototype.slice.call(arguments))}static fromJSON(t){const{zoneType:e}=t,i=ne()(t,["zoneType"]);if(!Z.includes(e))throw new Error("The zone type ".concat(e," is invalid or not yet supported"));return new de(new r[e](...Object.values(i)))}}de.prototype.initialize=function(){let t;return function(e){t=this.zones[Math.random()*this.zones.length>>0],t.getPosition(),e.position.x=t.vector.x,e.position.y=t.vector.y,e.position.z=t.vector.z}}();class fe extends Vt{constructor(t,e,i=!1,r=!0){super("Radius",r),this.radius=yt(t,e,i)}reset(t,e,i=!1){this.radius=yt(t,e,i)}initialize(t){t.radius=this.radius.getValue(),t.transform.oldRadius=t.radius}static fromJSON(t){const{width:e,height:i,center:r=!1,isEnabled:n=!0}=t;return new fe(e,i,r,n)}}class pe extends Vt{constructor(t=1,e=1){super("Rate"),this.numPan=yt(t),this.timePan=yt(e),this.startTime=0,this.nextTime=0,this.init()}init(){this.startTime=0,this.nextTime=this.timePan.getValue()}getValue(t){return this.startTime+=t,this.startTime>=this.nextTime?(this.init(),1==this.numPan.b?this.numPan.getValue("Float")>.5?1:0:this.numPan.getValue("Int")):0}static fromJSON(t){const{particlesMin:e,particlesMax:i,perSecondMin:r,perSecondMax:n}=t;return new pe(new pt(e,i),new pt(r,n))}}function ye(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function me(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ye(Object(i),!0).forEach((function(e){K()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ye(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}class ge extends Vt{constructor(t,e,i=Zt,r=!0){super("Texture",r);const{Sprite:n,SpriteMaterial:s}=t;this.materialProperties=dt(Zt,i),this.texture=e,this.material=new s(me(me({},{map:e}),this.materialProperties)),this.sprite=new n(this.material)}initialize(t){t.body=this.sprite}static fromJSON(t,e){const{loadedTexture:i,materialProperties:r=Lt,isEnabled:n=!0}=t;return new ge(e,i,dt(Lt,(t=>{const{blending:e}=t;return me(me({},t),{},{blending:e?Ft[e]:Ft[Lt.blending]})})(r)),n)}}class xe extends Vt{constructor(t,e=!0){super(t,e),this.dirVec=new St(0,0,0)}normalize(t){return 100*t}}xe.prototype.initialize=function(){var t,e=new St(0,0,1),i=new St(0,0,0);return function(r){return t=this.tha*Math.random(),this._useV&&this.dirVec.copy(this.dir).scalar(this.radiusPan.getValue()),ft.getNormal(this.dirVec,e),i.copy(this.dirVec).applyAxisAngle(e,t),i.applyAxisAngle(this.dirVec.normalize(),Math.random()*h*2),r.velocity.copy(i),this}}();class ve extends xe{constructor(t,e,i=!0){super("PolarVelocity",i),this.tha=e*u,this.dirVec=t.toVector3D(),this._useV=!1}static fromJSON(t){const{polarRadius:e,polarTheta:i,polarPhi:r,velocityTheta:n,isEnabled:s=!0}=t;return new ve(new Ct(e,i,r),n,s)}}class be extends xe{constructor(t,e,i,r=!0){super("RadialVelocity",r),this.radiusPan=yt(t),this.dir=e.clone().normalize(),this.tha=i*u,this._useV=!0}static fromJSON(t){const{radius:e,x:i,y:r,z:n,theta:s,isEnabled:o=!0}=t;return new be(e,new St(i,r,n),s,o)}}class _e extends xe{constructor(t,e,i=!0){super("VectorVelocity",i),this.radiusPan=yt(1),this.dir=t.clone(),this.tha=e*u,this._useV=!0}static fromJSON(t){const{x:e,y:i,z:r,theta:n,isEnabled:s=!0}=t;return new _e(new St(e,i,r),n,s)}}const ze=new pe(1,.1);var we=i(3),Me=i.n(we);class Ee extends At{constructor(t){super(t),this.type="Emitter",this.particles=[],this.initializers=[],this.behaviours=[],this.emitterBehaviours=[],this.currentEmitTime=0,this.totalEmitTimes=-1,this.damping=.006,this.bindEmitter=!0,this.bindEmitterEvent=!1,this.rate=ze,this.isEmitting=!1,this.id="emitter-".concat(ct()),this.cID=0,this.name="Emitter",this.index=void 0,this.eventDispatcher=new Rt}dispatch(t,e=this){this.eventDispatcher.dispatchEvent(t,e)}setRate(t){return this.rate=t,this}setPosition(t={}){const{position:e}=this,{x:i=e.x,y:r=e.y,z:n=e.z}=t;return this.position.set(i,r,n),this}setRotation(t={}){const{rotation:e}=this,{x:i=e.x,y:r=e.y,z:n=e.z}=t;return this.rotation.set(i,r,n),this}emit(t=1/0,e=1/0){return this.currentEmitTime=0,this.totalEmitTimes=Me()(t)?t:1/0,this.life=1===t?t:Me()(e)?e:1/0,this.rate.init(),this.isEmitting=!0,this}experimental_emit(){const{isEmitting:t,totalEmitTimes:e,life:i}=this;return t||(this.currentEmitTime=0,e||this.setTotalEmitTimes(1/0),i||this.setLife(1/0),this.rate.init(),this.isEmitting=!0),this}setTotalEmitTimes(t=1/0){return this.totalEmitTimes=Me()(t)?t:1/0,this}setLife(t=1/0){return 1===this.totalEmitTimes?this.life=this.totalEmitTimes:this.life=Me()(t)?t:1/0,this}stopEmit(){this.totalEmitTimes=-1,this.currentEmitTime=0,this.isEmitting=!1}removeAllParticles(){let t=this.particles.length;for(;t--;)this.particles[t].dead=!0}addInitializer(t){return this.initializers.push(t),this}addInitializers(t){let e=t.length;for(;e--;)this.addInitializer(t[e]);return this}setInitializers(t){return this.initializers=t,this}removeInitializer(t){const e=this.initializers.indexOf(t);return e>-1&&this.initializers.splice(e,1),this}removeAllInitializers(){return at.destroyArray(this.initializers),this}addBehaviour(t){return this.behaviours.push(t),this}addBehaviours(t){let e=t.length;for(;e--;)this.addBehaviour(t[e]);return this}setBehaviours(t){return this.behaviours=t,this}removeBehaviour(t){const e=this.behaviours.indexOf(t);return e>-1&&this.behaviours.splice(e,1),this}removeAllBehaviours(){return at.destroyArray(this.behaviours),this}addEmitterBehaviour(t){return this.emitterBehaviours.push(t),t.initialize(this),this}addEmitterBehaviours(t){let e=t.length;for(;e--;)this.addEmitterBehaviour(t[e]);return this}setEmitterBehaviours(t){const e=t.length;this.emitterBehaviours=t;for(let t=0;t<e;t++)this.emitterBehaviours[t].initialize(this);return this}removeEmitterBehaviour(t){const e=this.emitterBehaviours.indexOf(t);return e>-1&&this.emitterBehaviours.splice(e,1),this}removeAllEmitterBehaviours(){return at.destroyArray(this.emitterBehaviours),this}addOnEmitterDeadEventListener(t){return this.eventDispatcher.addEventListener("".concat(this.id,"_").concat(Bt.b),()=>t()),this}createParticle(){const t=this.parent.pool.get(At),e=this.particles.length;return this.setupParticle(t,e),this.parent&&this.parent.dispatch(Bt.d,t),this.bindEmitterEvent&&this.dispatch(Bt.d,t),t}setupParticle(t,e){const{initializers:i,behaviours:r}=this;Xt.initialize(this,t,i),t.addBehaviours(r),t.parent=this,t.index=e,this.particles.push(t)}update(t){if(!this.isEmitting)return;this.age+=t,(this.dead||this.age>=this.life)&&this.destroy(),this.generate(t),this.integrate(t);let e=this.particles.length;for(;e--;){const t=this.particles[e];t.dead&&(this.parent&&this.parent.dispatch(Bt.e,t),this.bindEmitterEvent&&this.dispatch(Bt.e,t),this.parent.pool.expire(t.reset()),this.particles.splice(e,1))}this.updateEmitterBehaviours(t)}updateEmitterBehaviours(t){if(this.sleep)return;const e=this.emitterBehaviours.length;for(let i=0;i<e;i++)this.emitterBehaviours[i].applyBehaviour(this,t,i)}integrate(t){const e=this.parent?this.parent.integrationType:wt,i=1-this.damping;Tt(this,t,i,e);let r=this.particles.length;for(;r--;){const n=this.particles[r];n.update(t,r),Tt(n,t,i,e),this.parent&&this.parent.dispatch(Bt.f,n),this.bindEmitterEvent&&this.dispatch(Bt.f,n)}}generate(t){if(1!==this.totalEmitTimes){if(this.currentEmitTime+=t,this.currentEmitTime<this.totalEmitTimes){let e=this.rate.getValue(t);for(e>0&&(this.cID=e);e--;)this.createParticle()}}else{let t=this.rate.getValue(99999);for(t>0&&(this.cID=t);t--;)this.createParticle();this.totalEmitTimes=0}}destroy(){this.dead=!0,this.energy=0,this.totalEmitTimes=-1,0==this.particles.length&&(this.isEmitting=!1,this.removeAllInitializers(),this.removeAllBehaviours(),this.dispatch("".concat(this.id,"_").concat(Bt.b)),this.parent&&this.parent.removeEmitter(this))}}const Oe=f;class Pe{constructor(t=1/0,e=Oe,i="Behaviour",r=!0){this.type=i,this.isEnabled=r,this.id="behaviour-".concat(ct()),this.life=t,this.easing=e,this.age=0,this.energy=1,this.dead=!1}reset(t=1/0,e=Oe){this.life=t,this.easing=e||Oe}set life(t){this._life=Me()(t)?t:1/0}get life(){return this._life}normalizeForce(t){return t.scalar(100)}normalizeValue(t){return 100*t}initialize(t){}applyBehaviour(t,e,i){this.isEnabled&&this.mutate(t,e,i)}mutate(t,e,i){}energize(t,e){if(this.dead)return;if(this.age+=e,this.age>=this.life)return this.energy=0,void(this.dead=!0);const i=this.easing(t.age/t.life);this.energy=Math.max(1-i,0)}destroy(){}fromJSON(t){}}class Te extends Pe{constructor(t=1,e=null,i,r,n=!0){super(i,r,"Alpha",n),this.alphaA=t,this.alphaB=e,this.reset(t,e)}get same(){return this._same}set same(t){this._same=t}reset(t=1,e=null,i,r){this.same=null==e,this.alphaA=yt(t),this.alphaB=yt(e),i&&super.reset(i,r)}initialize(t){t.useAlpha=!0,t.transform.alphaA=this.alphaA.getValue(),t.transform.alphaB=this.same?t.transform.alphaA:this.alphaB.getValue()}mutate(t,e,i){this.energize(t,e,i),t.alpha=ft.lerp(t.transform.alphaA,t.transform.alphaB,this.energy),t.alpha<.002&&(t.alpha=0)}static fromJSON(t){const{alphaA:e,alphaB:i,life:r,easing:n,isEnabled:s=!0}=t;return new Te(e,i,r,I(n),s)}}class Se extends Pe{constructor(t=new St,e=100,i=1e3,r=1/0,n=Oe,s=!0){super(r,n,"Attraction",s),this.targetPosition=t,this.radius=i,this.force=this.normalizeValue(e),this.radiusSq=this.radius*this.radius,this.attractionForce=new St,this.lengthSq=0}reset(t=new St,e=100,i=1e3,r,n){this.targetPosition=t,this.radius=i,this.force=this.normalizeValue(e),this.radiusSq=this.radius*this.radius,this.attractionForce=new St,this.lengthSq=0,r&&super.reset(r,n)}mutate(t,e,i){this.energize(t,e,i),this.attractionForce.copy(this.targetPosition),this.attractionForce.sub(t.position),this.lengthSq=this.attractionForce.lengthSq(),this.lengthSq>4e-6&&this.lengthSq<this.radiusSq&&(this.attractionForce.normalize(),this.attractionForce.scalar(1-this.lengthSq/this.radiusSq),this.attractionForce.scalar(this.force),t.acceleration.add(this.attractionForce))}static fromJSON(t){const{x:e,y:i,z:r,force:n,radius:s,life:o,easing:a,isEnabled:h=!0}=t;return new Se(new St(e,i,r),n,s,o,I(a),h)}}class Ce extends Pe{constructor(t,e,i,r,n,s=!0){super(r,n,"Collision",s),this.reset(t,e,i)}reset(t,e,i,r,n){this.emitter=t,this.useMass=e,this.onCollide=i,this.particles=[],this.delta=new St,r&&super.reset(r,n)}mutate(t,e,i){const r=this.emitter?this.emitter.particles.slice(i):this.particles.slice(i);let n,s,o,a,h,c,u=r.length;for(;u--;)n=r[u],n!=t&&(this.delta.copy(n.position).sub(t.position),s=this.delta.lengthSq(),a=t.radius+n.radius,s<=a*a&&(o=a-Math.sqrt(s),o+=.5,h=this._getAverageMass(t,n),c=this._getAverageMass(n,t),t.position.add(this.delta.clone().normalize().scalar(o*-h)),n.position.add(this.delta.normalize().scalar(o*c)),this.onCollide&&this.onCollide(t,n)))}_getAverageMass(t,e){return this.useMass?e.mass/(t.mass+e.mass):.5}fromJSON(t){}}class Ae extends Pe{constructor(t,e,i,r,n=!0){super(i,r,"Color",n),this.reset(t,e)}get same(){return this._same}set same(t){this._same=t}reset(t,e,i,r){this.same=null==e,this.colorA=_t(t),this.colorB=_t(e),i&&super.reset(i,r)}initialize(t){t.transform.colorA=$.getRGB(this.colorA.getValue()),t.useColor=!0,t.transform.colorB=this.same?t.transform.colorA:$.getRGB(this.colorB.getValue())}mutate(t,e,i){this.energize(t,e,i),this._same?(t.color.r=t.transform.colorA.r,t.color.g=t.transform.colorA.g,t.color.b=t.transform.colorA.b):(t.color.r=ft.lerp(t.transform.colorA.r,t.transform.colorB.r,this.energy),t.color.g=ft.lerp(t.transform.colorA.g,t.transform.colorB.g,this.energy),t.color.b=ft.lerp(t.transform.colorA.b,t.transform.colorB.b,this.energy))}static fromJSON(t){const{colorA:e,colorB:i,life:r,easing:n,isEnabled:s=!0}=t;return new Ae(e,i,r,I(n),s)}}class je extends Pe{constructor(t,e,i,r,n){super(i,r,"CrossZone",n),this.reset(t,e)}reset(t,e="dead",i,r){this.zone=t,this.zone.crossType=e,i&&super.reset(i,r)}mutate(t,e,i){this.energize(t,e,i),this.zone.crossing.call(this.zone,t)}static fromJSON(t){const{zoneType:e,zoneParams:i,crossType:n,life:s,easing:o,isEnabled:a=!0}=t,h=new r[e](...Object.values(i));return new je(h,n,s,I(o),a)}}class Be extends Pe{constructor(t,e,i,r,n,s=!0){super(r,n,"Force",s),this.reset(t,e,i)}reset(t,e,i){this.force=this.normalizeForce(new St(t,e,i)),this.force.id=Math.random()}mutate(t,e,i){this.energize(t,e,i),t.acceleration.add(this.force)}static fromJSON(t){const{fx:e,fy:i,fz:r,life:n,easing:s,isEnabled:o=!0}=t;return new Be(e,i,r,n,I(s),o)}}class Re extends Be{constructor(t,e,i,r=!0){super(0,-t,0,e,i,r),this.type="Gravity"}static fromJSON(t){const{gravity:e,life:i,easing:r,isEnabled:n=!0}=t;return new Re(e,i,I(r),n)}}class Ve extends Pe{constructor(t,e,i,r=.03,n,s,o=!0){super(n,s,"RandomDrift",o),this.reset(t,e,i,r),this.time=0}reset(t,e,i,r=.03,n,s){this.randomForce=this.normalizeForce(new St(t,e,i)),this.delayPan=yt(r),this.time=0,n&&super.reset(n,s)}mutate(t,e,i){if(this.energize(t,e,i),this.time+=e,this.time>=this.delayPan.getValue()){const e=ft.randomAToB(-this.randomForce.x,this.randomForce.x),i=ft.randomAToB(-this.randomForce.y,this.randomForce.y),r=ft.randomAToB(-this.randomForce.z,this.randomForce.z);t.acceleration.addValue(e,i,r),this.time=0}}static fromJSON(t){const{x:e,y:i,z:r,delay:n,life:s,easing:o,isEnabled:a=!0}=t;return new Ve(e,i,r,n,s,I(o),a)}}class Ie extends Se{constructor(t,e,i,r,n,s=!0){super(t,e,i,r,n,s),this.force*=-1,this.type="Repulsion"}reset(t,e,i,r,n){super.reset(t,e,i,r,n),this.force*=-1}static fromJSON(t){const{x:e,y:i,z:r,force:n,radius:s,life:o,easing:a,isEnabled:h=!0}=t;return new Ie(new St(e,i,r),n,s,o,I(a),h)}}class De extends Pe{constructor(t,e,i,r,n,s=!0){super(r,n,"Rotate",s),this.reset(t,e,i)}get rotationType(){return this._rotationType}set rotationType(t){this._rotationType=t}reset(t,e,i,r,n){this.x=t||0,this.y=e||0,this.z=i||0,void 0===t||"same"==t?this.rotationType="same":null==e?this.rotationType="set":void 0===i?this.rotationType="to":(this.rotationType="add",this.x=yt(this.x*u),this.y=yt(this.y*u),this.z=yt(this.z*u)),r&&super.reset(r,n)}initialize(t){switch(this.rotationType){case"same":break;case"set":this._setRotation(t.rotation,this.x);break;case"to":t.transform.fR=t.transform.fR||new St,t.transform.tR=t.transform.tR||new St,this._setRotation(t.transform.fR,this.x),this._setRotation(t.transform.tR,this.y);break;case"add":t.transform.addR=new St(this.x.getValue(),this.y.getValue(),this.z.getValue())}}_setRotation(t,e){if(t=t||new St,"random"==e){var i=ft.randomAToB(-h,h),r=ft.randomAToB(-h,h),n=ft.randomAToB(-h,h);t.set(i,r,n)}else e instanceof St&&t.copy(e)}mutate(t,e,i){switch(this.energize(t,e,i),this.rotationType){case"same":t.rotation||(t.rotation=new St),t.rotation.eulerFromDir(t.velocity);break;case"set":break;case"to":t.rotation.x=ft.lerp(t.transform.fR.x,t.transform.tR.x,this.energy),t.rotation.y=ft.lerp(t.transform.fR.y,t.transform.tR.y,this.energy),t.rotation.z=ft.lerp(t.transform.fR.z,t.transform.tR.z,this.energy);break;case"add":t.rotation.add(t.transform.addR)}}static fromJSON(t){const{x:e,y:i,z:r,life:n,easing:s,isEnabled:o=!0}=t;return new De(e,i,r,n,I(s),o)}}class ke extends Pe{constructor(t,e,i,r,n=!0){super(i,r,"Scale",n),this.reset(t,e)}get same(){return this._same}set same(t){this._same=t}reset(t,e,i,r){this.same=null==e,this.scaleA=yt(t||1),this.scaleB=yt(e),i&&super.reset(i,r)}initialize(t){t.transform.scaleA=this.scaleA.getValue(),t.transform.oldRadius=t.radius,t.transform.scaleB=this.same?t.transform.scaleA:this.scaleB.getValue()}mutate(t,e,i){this.energize(t,e,i),t.scale=ft.lerp(t.transform.scaleA,t.transform.scaleB,this.energy),t.scale<5e-4&&(t.scale=0),t.radius=t.transform.oldRadius*t.scale}static fromJSON(t){const{scaleA:e,scaleB:i,life:r,easing:n,isEnabled:s=!0}=t;return new ke(e,i,r,I(n),s)}}class Fe extends Pe{constructor(t,e,i,r,n,s,o,a=!0){super(s,o,"Spring",a),this.reset(t,e,i,r,n)}reset(t,e,i,r,n){this.pos?this.pos.set(t,e,i):this.pos=new St(t,e,i),this.spring=r||.1,this.friction=n||.98}mutate(t,e,i){this.energize(t,e,i),t.velocity.x+=(this.pos.x-t.position.x)*this.spring,t.velocity.y+=(this.pos.y-t.position.y)*this.spring,t.velocity.z+=(this.pos.z-t.position.z)*this.spring}static fromJSON(t){const{x:e,y:i,z:r,spring:n,friction:s,life:o,easing:a,isEnabled:h=!0}=t;return new Fe(e,i,r,n,s,o,I(a),h)}}const Ze=t=>{const e=[];return t.forEach(t=>{const{type:i,properties:r}=t;if(!F.includes(i))throw new Error("The behaviour type ".concat(i," is invalid or not yet supported"));e.push(s[i].fromJSON(r))}),e};var Le=(t,e,i,r)=>{const{preParticles:s=c,integrationType:a=l,emitters:h=[]}=t,u=new i(e,s,a);return h.forEach(t=>{const i=new r,{rate:s,rotation:a,initializers:h,behaviours:c,emitterBehaviours:l=[],position:d,totalEmitTimes:f=1/0,life:p=1/0}=t;i.setRate((t=>pe.fromJSON(t))(s)).setRotation(a).setInitializers(((t,e)=>{const i=[];return t.forEach(t=>{const{type:r,properties:s}=t;if(!k.includes(r))throw new Error("The initializer type ".concat(r," is invalid or not yet supported"));o.includes(r)?i.push(n[r].fromJSON(s,e)):i.push(n[r].fromJSON(s))}),i})(h,e)).setBehaviours(Ze(c)).setEmitterBehaviours(Ze(l)).setPosition(d).emit(f,p),u.addEmitter(i)}),u};function Ne(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function Ue(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ne(Object(i),!0).forEach((function(e){K()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ne(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}const qe=t=>new Promise((e,i)=>{if(!t.length)return e([]);const r=t.length,n=[];t.forEach(t=>{const{type:o,properties:a}=t;return F.includes(o)?(n.push(s[o].fromJSON(a)),n.length===r?e(n):void 0):i("The behaviour type ".concat(o," is invalid or not yet supported"))})}),Ye=(t,e,i,r)=>new Promise((s,a)=>{if(!t.length)return s([]);const h=[],c=t.length;if(!c)return s(h);t.forEach(t=>{const u=new e,{rate:l,rotation:d,initializers:f,behaviours:p,emitterBehaviours:y=[],position:m,totalEmitTimes:g=1/0,life:x=1/0}=t;var v;u.setRate((v=l,pe.fromJSON(v))).setRotation(d).setPosition(m),((t,e)=>new Promise((i,r)=>{if(!t.length)return i([]);const s=t.length,a=[],h=t.filter(({properties:t})=>!t.texture),c=t.filter(({properties:t})=>t.texture);h.forEach(t=>{const{type:h,properties:c}=t;return k.includes(h)?(o.includes(h)?a.push(n[h].fromJSON(c,e)):a.push(n[h].fromJSON(c)),a.length===s?i(a):void 0):r("The initializer type ".concat(h," is invalid or not yet supported"))}),c.forEach(t=>{const{type:n,properties:o,properties:{texture:h}}=t,c=new e.TextureLoader;if(!k.includes(n))return r("The initializer type ".concat(n," is invalid or not yet supported"));c.load(h,t=>{if(a.push(ge.fromJSON(Ue(Ue({},o),{},{loadedTexture:t}),e)),a.length===s)return i(a)},void 0,r)})}))(f,i).then(t=>(u.setInitializers(t),qe(p))).then(t=>(u.setBehaviours(t),qe(y))).then(t=>(u.setEmitterBehaviours(t),Promise.resolve(u))).then(t=>{if(h.push(r?t.emit(g,x):t.setTotalEmitTimes(g).setLife(x)),h.length===c)return s(h)}).catch(a)})});class Xe{constructor(t=c,e=wt){this.type="System",this.canUpdate=!0,this.preParticles=t,this.integrationType=e,this.emitters=[],this.renderers=[],this.pool=new jt,this.eventDispatcher=new Rt}static fromJSON(t,e){return Le(t,e,Xe,Ee)}static fromJSONAsync(t,e,{shouldAutoEmit:i=!1}={}){return((t,e,i,r,{shouldAutoEmit:n=!0}={})=>new Promise((s,o)=>{const{preParticles:a=c,integrationType:h=l,emitters:u=[]}=t,d=new i(a,h);Ye(u,r,e,n).then(t=>{const e=t.length;if(!e)return s(d);t.forEach(t=>{d.addEmitter(t),d.emitters.length===e&&s(d)})}).catch(o)}))(t,e,Xe,Ee,{shouldAutoEmit:i})}dispatch(t,e=this){this.eventDispatcher.dispatchEvent(t,e)}addRenderer(t){return this.renderers.push(t),t.init(this),this}removeRenderer(t){return this.renderers.splice(this.renderers.indexOf(t),1),t.remove(this),this}addEmitter(t){const e=this.emitters.length;return t.parent=this,t.index=e,this.emitters.push(t),this.dispatch(Bt.a,t),this}removeEmitter(t){return t.parent!==this||(t.parent=null,t.index=void 0,this.emitters.splice(this.emitters.indexOf(t),1),this.dispatch(Bt.c,t)),this}emit({onStart:t,onUpdate:e,onEnd:i}){t&&t(),e&&this.eventDispatcher.addEventListener(Bt.g,e);const r=this.emitters.map(t=>{const{life:e}=t;return e===1/0?(i&&i(),t.experimental_emit(),Promise.resolve()):new Promise(e=>{t.addOnEmitterDeadEventListener(()=>{i&&i(),e()}),t.experimental_emit()})});try{return Promise.all(r)}catch(t){console.warn(t)}}update(t=.0167){const e=t||.0167;if(this.canUpdate){if(e>0){let t=this.emitters.length;for(;t--;){const i=this.emitters[t];i.update(e),i.isEmitting&&this.dispatch(Bt.g)}}this.dispatch(Bt.h)}return Promise.resolve()}getCount(){const t=this.emitters.length;let e,i=0;for(e=0;e<t;e++)i+=this.emitters[e].particles.length;return i}destroy(){const t=this.emitters.length;this.canUpdate=!1;for(let e=0;e<t;e++)this.emitters[e]&&this.emitters[e].destroy(),delete this.emitters[e];this.emitters.length=0,this.pool.destroy(),this.canUpdate=!0}}const Je=15,Ge=0;var Qe={addEventListener:function(t,e){return t.eventDispatcher.addEventListener("SYSTEM_UPDATE",e),this},drawZone:function(t,e,i,r={}){const{width:n=Je,height:s=Je,depth:o=Je,radius:a=Je,x:h=Ge,y:c=Ge,z:u=Ge}=r;let l;r.isPointZone()&&(l=new t.SphereGeometry(15)),r.isLineZone(),r.isBoxZone()&&(l=new t.BoxGeometry(n,s,o)),r.isSphereZone()&&(l=new t.SphereGeometry(a,Je,Je)),r.isMeshZone()&&(l=r.geometry.geometry?r.geometry.geometry.clone():r.geometry.clone()),l||(l=new t.BoxGeometry(n,s,o));const d=new t.MeshBasicMaterial({color:"#2194ce",wireframe:!0}),f=new t.Mesh(l.clone(),d);i.add(f),this.addEventListener(e,(function(){f.position.set(h,c,u)}))},drawEmitter:function(t,e,i,r,n){const s=new t.OctahedronGeometry(Je),o=new t.MeshBasicMaterial({color:n||"#aaa",wireframe:!0}),a=new t.Mesh(s.clone(),o);i.add(a),this.addEventListener(e,(function(){a.position.copy(r.position),a.rotation.set(r.rotation.x,r.rotation.y,r.rotation.z)}))},renderInfo:function(){function t(t,e){var i="material"==t?"_materialPool":"_targetPool";return e.renderers[0][i].cID}return function(e,i){this.addInfo(i);var r="";switch(this._infoType){case 2:r+="emitter:"+e.emitters.length+"<br>",r+="em speed:"+e.emitters[0].cID+"<br>",r+="pos:"+function(t){var e=t.emitters[0];return Math.round(e.p.x)+","+Math.round(e.p.y)+","+Math.round(e.p.z)}(e);break;case 3:r+=e.renderers[0].name+"<br>",r+="target:"+t("target")+"<br>",r+="material:"+t("material");break;default:r+="particles:"+e.getCount()+"<br>",r+="pool:"+e.pool.getCount()+"<br>",r+="total:"+(e.getCount()+e.pool.getCount())}this._infoCon.innerHTML=r}}(),addInfo:function(t){var e=this;if(!this._infoCon){var i,r;switch(this._infoCon=document.createElement("div"),this._infoCon.style.cssText=["position:fixed;bottom:0px;left:0;cursor:pointer;","opacity:0.9;z-index:10000;padding:10px;font-size:12px;","width:120px;height:50px;background-color:#002;color:#0ff;"].join(""),this._infoType=1,this._infoCon.addEventListener("click",(function(){e._infoType++,e._infoType>3&&(e._infoType=1)}),!1),t){case 2:i="#201",r="#f08";break;case 3:i="#020",r="#0f0";break;default:i="#002",r="#0ff"}this._infoCon.style["background-color"]=i,this._infoCon.style.color=r}this._infoCon.parentNode||document.body.appendChild(this._infoCon)}},He=function(){let t=0;if(window.console&&window.console.trace){var e=Array.prototype.slice.call(arguments),i=arguments[0]+"";if(0==i.indexOf("+")){var r=parseInt(arguments[0]);t<r&&(e.shift(),console.trace.apply(console,e),t++)}else e.unshift("+15"),this.apply(console,e)}};class We extends Ee{constructor(t,e,i){super(i),this.type="FollowEmitter",this.mouseTarget=at.initValue(t,window),this.ease=at.initValue(e,.7),this._allowEmitting=!1,this.initEventHandler()}initEventHandler(){var t=this;this.mousemoveHandler=function(e){t.mousemove.call(t,e)},this.mousedownHandler=function(e){t.mousedown.call(t,e)},this.mouseupHandler=function(e){t.mouseup.call(t,e)},this.mouseTarget.addEventListener("mousemove",this.mousemoveHandler,!1)}emit(){this._allowEmitting=!0}stopEmit(){this._allowEmitting=!1}setCameraAndCanvas(t,e){this.camera=t,this.canvas=e}mousemove(t){t.layerX||0==t.layerX?(this.position.x+=(t.layerX-this.position.x)*this.ease,this.position.y+=(t.layerY-this.position.y)*this.ease):(t.offsetX||0==t.offsetX)&&(this.position.x+=(t.offsetX-this.position.x)*this.ease,this.position.y+=(t.offsetY-this.position.y)*this.ease),this.position.copy(ot.toSpacePos(this.position,this.camera,this.canvas)),this._allowEmitting&&super.emit("once")}destroy(){super.destroy(),this.mouseTarget.removeEventListener("mousemove",this.mousemoveHandler,!1)}}var Ke=i(4);class $e extends Ke.a{constructor(){super(a.b),this.targetPool=new jt,this.materialPool=new jt}onSystemUpdate(){}onParticleCreated(t){}onParticleUpdate(t){}onParticleDead(t){}}class ti extends Ke.a{constructor(t,e){super(a.d),this.container=t,this._targetPool=new jt,this._materialPool=new jt,this._body=new e.Mesh(new e.BoxGeometry(50,50,50),new e.MeshLambertMaterial({color:"#ff0000"}))}isThreeSprite(t){return t.target.isSprite}onSystemUpdate(){}onParticleCreated(t){t.target||(t.body||(t.body=this._body),t.target=this._targetPool.get(t.body),(t.useAlpha||t.useColor)&&(t.target.material.__puid=tt.id(t.body.material),t.target.material=this._materialPool.get(t.target.material))),t.target&&(t.target.position.copy(t.position),this.container.add(t.target))}onParticleUpdate(t){const{target:e,useAlpha:i,useColor:r,rotation:n}=t;e&&(e.position.copy(t.position),this.isThreeSprite(t)||e.rotation.set(n.x,n.y,n.z),this.scale(t),i&&(e.material.opacity=t.alpha,e.material.transparent=!0),r&&e.material.color.copy(t.color))}scale(t){t.target.scale.set(t.scale,t.scale,t.scale)}onParticleDead(t){t.target&&((t.useAlpha||t.useColor)&&this._materialPool.expire(t.target.material),this._targetPool.expire(t.target),this.container.remove(t.target),t.target=null)}}class ei extends ti{constructor(t,e){super(t,e),this.type=a.e,this._body=new e.Sprite(new e.SpriteMaterial({color:16777215}))}scale(t){t.target.scale.set(t.scale*t.radius,t.scale*t.radius,1)}}class ii{constructor(t){this.position=new t.Vector3,this.size=0,this.color=new t.Color,this.alpha=0,this.texture=null,this.index=0}reset(){this.position.set(0,0,0),this.size=0,this.color.setRGB(0,0,0),this.alpha=0,this.texture=null}}class ri{constructor(t=1/0){this.max=t,this.items=[]}add(t){if(!this.has(t)){if(this.items.length+1===this.max)throw new Error("UniqueList max size exceeded");this.items.push(t)}}has(t){return this.items.indexOf(t)>0}find(t){return this.items.indexOf(t)}}const ni=["x","y","z"].length,si=["r","g","b","a"].length,oi=([4*ni,4,4*si].reduce((t,e)=>t+e),{blending:"AdditiveBlending",baseColor:16777215,depthTest:!0,depthWrite:!1,transparent:!0,maxParticles:1e4}),ai=["x","y","z"].length,hi=["r","g","b","a"].length,ci=[4*ai,4,4*hi].reduce((t,e)=>t+e),ui={position:ai,size:1,color:hi,alpha:1};let li,di;class fi{constructor(t=1e4,e){li=e,this.maxParticles=t,this.createInterleavedBuffer().createBufferGeometry()}createInterleavedBuffer(){const t=new ArrayBuffer(this.maxParticles*ci);return this.interleavedBuffer=new li.InterleavedBuffer(new Float32Array(t),ci),this}createBufferGeometry(){this.geometry=new li.BufferGeometry;const{interleavedBuffer:t,geometry:e}=this;return Object.keys(ui).reduce((i,r)=>{const n=ui[r];return e.setAttribute(r,new li.InterleavedBufferAttribute(t,n,i)),i+n},0),this}get buffer(){return this.interleavedBuffer}get stride(){return ci}}function pi(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function yi(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?pi(Object(i),!0).forEach((function(e){K()(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):pi(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}class mi extends Ke.a{constructor(t,e,i=oi){super(a.c),di=e;const r=yi(yi({},oi),i),{camera:n,maxParticles:s,baseColor:o,blending:h,depthTest:c,depthWrite:u,transparent:l}=r,d=new fi(s,di),f=new di.ShaderMaterial({uniforms:{baseColor:{value:new di.Color(o)},texture:{value:null}},vertexShader:"\n    attribute float size;\n    attribute vec3 color;\n    attribute float alpha;\n\n    varying vec3 targetColor;\n    varying float targetAlpha;\n\n    void main() {\n      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n      targetColor = color;\n      targetAlpha = alpha;\n\n      gl_PointSize = size * (".concat("600.0"," / -mvPosition.z);\n      gl_Position = projectionMatrix * mvPosition;\n    }\n"),fragmentShader:"\n    uniform vec3 baseColor;\n    uniform sampler2D texture;\n\n    varying vec3 targetColor;\n    varying float targetAlpha;\n\n    void main() {\n      gl_FragColor = vec4(baseColor * targetColor, targetAlpha);\n      gl_FragColor = gl_FragColor * texture2D(texture, gl_PointCoord);\n    }\n",blending:di[h],depthTest:c,depthWrite:u,transparent:l});this.camera=n,this.targetPool=new jt,this.uniqueList=new ri(s),this.particleBuffer=d,this.buffer=d.buffer,this.stride=d.stride,this.geometry=d.geometry,this.material=f,this.points=new di.Points(this.geometry,this.material),t.add(this.points)}onParticleCreated(t){t.target||(t.target=this.targetPool.get(ii,di),this.uniqueList.add(t.id)),this.updateTarget(t).mapParticleTargetPropsToPoint(t)}onParticleUpdate(t){t.target&&this.updateTarget(t).mapParticleTargetPropsToPoint(t)}onParticleDead(t){t.target&&(t.target.reset(),this.mapParticleTargetPropsToPoint(t),t.target=null)}updateTarget(t){const{position:e,scale:i,radius:r,color:n,alpha:s,body:o,id:a}=t,{r:h,g:c,b:u}=n;return t.target.position.copy(e),t.target.size=i*r,t.target.color.setRGB(h,c,u),t.target.alpha=s,t.target.index=this.uniqueList.find(a),o&&o instanceof di.Sprite&&(t.target.texture=o.material.map,this.material.uniforms.texture={value:t.target.texture}),this}mapParticleTargetPropsToPoint(t){return this.updatePointPosition(t).updatePointSize(t).updatePointColor(t).updatePointAlpha(t).ensurePointUpdatesAreRendered(),this}updatePointPosition(t){const{geometry:e,stride:i,buffer:r}=this,{target:n}=t,{offset:s}=e.attributes.position;return r.array[n.index*i+s+0]=n.position.x,r.array[n.index*i+s+1]=n.position.y,r.array[n.index*i+s+2]=n.position.z,this}updatePointSize(t){const{geometry:e,stride:i,buffer:r}=this,{target:n}=t,{offset:s}=e.attributes.size;return r.array[n.index*i+s+0]=n.size,this}updatePointColor(t){const{geometry:e,stride:i,buffer:r}=this,{target:n}=t,{offset:s}=e.attributes.color;return r.array[n.index*i+s+0]=n.color.r,r.array[n.index*i+s+1]=n.color.g,r.array[n.index*i+s+2]=n.color.b,this}updatePointAlpha(t){const{geometry:e,stride:i,buffer:r}=this,{target:n}=t,{offset:s}=e.attributes.alpha;return r.array[n.index*i+s+0]=n.alpha,this}ensurePointUpdatesAreRendered(){return Object.keys(this.geometry.attributes).map(t=>{this.geometry.attributes[t].data.needsUpdate=!0}),this}}e.default=Xe}])}));
//# sourceMappingURL=three-nebula.js.map